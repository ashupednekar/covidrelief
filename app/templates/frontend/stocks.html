{% extends "frontend/base.html" %}

{% load static %}

{% block page %}

<div class="dashboard-ecommerce">
        <div class="container-fluid dashboard-content ">
            <!-- ============================================================== -->
            <!-- pageheader  -->
            <!-- ============================================================== -->
            <div class="row">
                <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 col-12">
                    <div class="page-header">
                        <div class="page-breadcrumb">
                            <nav aria-label="breadcrumb">
                                <ol class="breadcrumb">
                                    <li class="breadcrumb-item"><a href="#" class="breadcrumb-link">Stocks</a></li>
                                    <li class="breadcrumb-item"><a href="#" class="breadcrumb-link">Manage stocks</a></li>
                                </ol>
                            </nav>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-xl-3 col-lg-3 col-md-6 col-sm-12 col-12">
                    <div class="card border-3 border-top border-top-primary">
                        <div class="card-body">
                            <h5 class="text-muted">Total stocks</h5>
                            <div class="metric-value d-inline-block">
                                <h1 class="mb-1" id="totalstockdisplay">{{ total }}</h1><br>
                            </div>
                            <div class="metric-label d-inline-block float-right text-success font-weight-bold">
                                {% if total < 50 %}
                                <span class="icon-circle-small icon-box-xs text-danger bg-danger-light"><i class="fa fa-fw fa-warning"></i></span>
                                {% else %}
                                <span class="icon-circle-small icon-box-xs text-success bg-success-light"><i class="fa fa-fw fa-info"></i></span>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
                <script src="https://cdn.jsdelivr.net/npm/sweetalert2@9"></script>
                <div class="col-xl-3 col-lg-3 col-md-6 col-sm-12 col-12">
                    <div class="card border-3 border-top border-top-primary">
                        <div class="card-body">
                            <h5 class="text-muted">Update stocks</h5>
                            <form>
                                <div class="row">
                                    <div class="col-sm-8">
                                        <div class="form-group">
                                            <input id="stock_count" type="number" value="{{ total }}" class="form-control">
                                        </div>
                                    </div>
                                    <div class="col-sm-4">
                                        <div class="form-group">
                                            <button class="btn btn-success" id="done">Update  <i class="fa fa-save"></i></button>
                                        </div>
                                    </div>
                                </div>
                                <script>
                                    jQuery('#done').on('click', function (event) {
                                        event.preventDefault()
                                        var fd = new FormData();
                                        fd.append('stock_count', jQuery('#stock_count').val())
                                        jQuery.ajax({
                                            "method": "POST",
                                            "url": "{{ host }}/updatetotalstock",
                                            "data": fd,
                                            "processData": false,
                                            "contentType": false,
                                            "headers": {"X-CSRFToken": "{{ csrf_token }}"},
                                            "success": function (res) {
                                                Swal.fire(
                                                    'Success!',
                                                    'Stock updated successfully!',
                                                    'success'
                                                );
                                                jQuery('#totalstockdisplay').html(res['count']);
                                            }
                                        });
                                    });
                                </script>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
</div>
{% endblock %}